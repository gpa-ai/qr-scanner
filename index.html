<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanner QR Code / Code-barres</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <h1>Scanner QR Code / Code-barres</h1>
  <div id="reader" style="width: 300px; height: 300px; margin: auto;"></div>
  <p id="status"></p>

  <script>
    const googleScriptURL = "https://script.google.com/macros/s/TON_SCRIPT_DEPLOYMENT_ID/exechttps://script.google.com/macros/s/AKfycbxTVggQpTdWxF_lsoCwjhW2UZPyngN2JakJHQLDUL2XYUxnREzUONPTAMKFxlTqniTnGQ/exec";

    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById("status").innerText = "Données scannées : " + decodedText;
      
      // Création de l'objet FormData pour envoyer les données
      const formData = new FormData();
      formData.append("data", decodedText);

      // Envoi des données au Google Apps Script
      fetch(googleScriptURL, {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(responseText => {
        document.getElementById("status").innerText = "Données envoyées avec succès !";
      })
      .catch(error => {
        console.error("Erreur lors de l'envoi des données :", error);
        document.getElementById("status").innerText = "Erreur lors de l'envoi des données.";
      });
    }

    function onScanFailure(error) {
      // Ignorer les erreurs d'échec pour éviter les logs excessifs.
      console.warn(`Scan échoué: ${error}`);
    }

    function startScanner() {
      const html5QrcodeScanner = new Html5Qrcode("reader");
      html5QrcodeScanner.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: { width: 250, height: 250 }
        },
        onScanSuccess,
        onScanFailure
      ).catch(err => {
        console.error("Erreur de démarrage du scanner :", err);
        document.getElementById("status").innerText = "Impossible d'accéder à la caméra.";
      });
    }

    // Démarre le scanner une fois la page chargée
    window.addEventListener("load", startScanner);
  </script>
</body>
</html>
